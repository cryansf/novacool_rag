<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Novacool AI Assistant</title>

<style>
    body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #0a0a0a;
        color: white;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .header {
        background: linear-gradient(90deg, #001e46, #b30000);
        padding: 14px 18px;
        font-size: 22px;
        font-weight: 600;
        text-align: center;
        box-shadow: 0 0 12px rgba(255,0,0,0.4);
    }

    #chatContainer {
        flex: 1;
        overflow-y: auto;
        padding: 18px;
        background: #121212;
    }

    .msg {
        max-width: 85%;
        padding: 12px 15px;
        margin-bottom: 10px;
        border-radius: 12px;
        line-height: 1.5;
        word-wrap: break-word;
        white-space: pre-wrap;
    }

    .user {
        background: #004ba8;
        align-self: flex-end;
        margin-left: auto;
    }

    .ai {
        background: #222;
        border: 1px solid #b30000;
        box-shadow: 0 0 10px rgba(255,0,0,0.25);
    }

    .inputBar {
        display: flex;
        gap: 8px;
        padding: 12px;
        background: #0e0e0e;
        border-top: 1px solid #222;
    }

    .inputBar input {
        flex: 1;
        background: #1a1a1a;
        border: 1px solid #444;
        color: white;
        font-size: 17px;
        padding: 12px 14px;
        border-radius: 8px;
    }
    .inputBar input:focus {
        outline: none;
        border: 1px solid #b30000;
        box-shadow: 0 0 8px rgba(255,0,0,0.35);
    }

    .inputBar button {
        background: linear-gradient(45deg, #001e46, #b30000);
        border: none;
        color: white;
        padding: 12px 20px;
        font-size: 17px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 0 6px rgba(255,0,0,0.35);
        transition: 0.25s;
    }
    .inputBar button:hover {
        transform: scale(1.04);
        box-shadow: 0 0 10px rgba(255,0,0,0.55);
    }
</style>
</head>
<body>

<div class="header">
    Novacool AI â€“ Fire Science Assistant
</div>

<div id="chatContainer"></div>

<div class="inputBar">
    <input id="userInput" type="text"
        placeholder="Ask anything about Novacool UEF, firefighting, ratios, trainingâ€¦" />
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    const chat = document.getElementById("chatContainer");
    const input = document.getElementById("userInput");

    // FULL URL so widget works outside Render as well
    const API_URL = "https://novacool-rag.onrender.com/chat";

    function appendMessage(role, text) {
        const div = document.createElement("div");
        div.className = "msg " + (role === "user" ? "user" : "ai");
        div.textContent = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }

    async function sendMessage() {
        const question = input.value.trim();
        if (!question) return;
        appendMessage("user", question);
        input.value = "";

        try {
            const res = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query: question })
            });
            const data = await res.json();
            appendMessage("ai", data.answer || "(No response)");
        } catch (err) {
            appendMessage("ai", "âš  Backend unreachable â€” check deployment");
        }
        resizeFrame();
    }

    input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendMessage();
    });

    function resizeFrame() {
        if (window.parent) {
            window.parent.postMessage(
                { height: document.body.scrollHeight },
                "*"
            );
        }
    }

    const observer = new MutationObserver(resizeFrame);
    observer.observe(chat, { childList: true });
    resizeFrame();
</script>

</body>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Novacool AI Widget</title>

<style>
:root {
  --primary: #ff5722;
  --dark: #0f1115;
  --text: #ffffff;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: transparent;
  overflow: hidden;
}

.widget-frame {
  width: 100%;
  height: 100%;
  background: var(--dark);
  border: 3px solid var(--primary);
  border-radius: 15px;
  display: flex;
  flex-direction: column;
}

.header {
  background: linear-gradient(90deg, #ff2b06, #ff8900);
  padding: 12px;
  font-size: 20px;
  font-weight: bold;
  color: var(--text);
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-radius: 12px 12px 0 0;
}

.close-btn {
  cursor: pointer;
  font-size: 28px;
  color: #fff;
  line-height: 22px;
}

.chat-history {
  flex: 1;
  overflow-y: auto;
  padding: 14px;
  color: var(--text);
  font-size: 16px;
}

.input-row {
  display: flex;
  gap: 6px;
  padding: 12px;
  background: #181a1f;
  border-radius: 0 0 12px 12px;
}

#user-input {
  flex: 1;
  padding: 14px;
  border-radius: 8px;
  border: none;
  font-size: 15px;
  outline: none;
}

.send-btn {
  background: var(--primary);
  border: none;
  border-radius: 50%;
  width: 54px;
  height: 54px;
  cursor: pointer;
  font-size: 22px;
  color: #fff;
}
</style>
</head>

<body>
<div class="widget-frame">
  <div class="header">
    ðŸ”¥ Ask Novacool AI
    <div class="close-btn" onclick="window.parent.postMessage({ action: 'closeWidget' }, '*')">Ã—</div>
  </div>

  <div id="file-list" style="padding: 8px; color: #ccc; font-size: 13px;"></div>

  <div class="chat-history" id="chat-history"></div>

  <div class="input-row">
    <input id="user-input" placeholder="Type your question..." />
    <button class="send-btn" onclick="sendMessage()">âž¤</button>
  </div>
</div>

<script>
async function loadFiles() {
  try {
    const res = await fetch("https://novacool-rag.onrender.com/files");
    const data = await res.json();
    if (data.files.length > 0) {
      document.getElementById("file-list").innerHTML =
        "<b>Loaded documents:</b><br>" +
        data.files.map(f => "â€¢ " + f).join("<br>");
    } else {
      document.getElementById("file-list").innerHTML =
        "<i>No documents indexed yet.</i>";
    }
  } catch {}
}
loadFiles();

function addMessage(role, text) {
  const box = document.getElementById("chat-history");
  const div = document.createElement("div");
  div.style.marginBottom = "14px";
  div.innerHTML = `<b>${role}:</b> ${text}`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

async function sendMessage() {
  const input = document.getElementById("user-input");
  const msg = input.value.trim();
  if (!msg) return;
  addMessage("You", msg);
  input.value = "";

  const res = await fetch("https://novacool-rag.onrender.com/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ question: msg })
  });

  const data = await res.json();
  addMessage("Novacool AI", data.answer);
}

document.getElementById("user-input").addEventListener("keypress", e => {
  if (e.key === "Enter") sendMessage();
});
</script>
</body>
</html>

