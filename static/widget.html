<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Novacool AI Assistant</title>

<style>
    body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #0a0a0a;
        color: white;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .header {
        background: linear-gradient(90deg, #001e46, #b30000);
        padding: 14px 18px;
        font-size: 22px;
        font-weight: 600;
        text-align: center;
        box-shadow: 0 0 12px rgba(255,0,0,0.4);
    }

    #chatContainer {
        flex: 1;
        overflow-y: auto;
        padding: 18px;
        background: #121212;
    }

    .msg {
        max-width: 85%;
        padding: 12px 15px;
        margin-bottom: 10px;
        border-radius: 12px;
        line-height: 1.5;
        word-wrap: break-word;
        white-space: pre-wrap;
    }

    .user {
        background: #004ba8;
        align-self: flex-end;
        margin-left: auto;
    }

    .ai {
        background: #222;
        border: 1px solid #b30000;
        box-shadow: 0 0 10px rgba(255,0,0,0.25);
    }

    .inputBar {
        display: flex;
        gap: 8px;
        padding: 12px;
        background: #0e0e0e;
        border-top: 1px solid #222;
    }

    .inputBar input {
        flex: 1;
        background: #1a1a1a;
        border: 1px solid #444;
        color: white;
        font-size: 17px;
        padding: 12px 14px;
        border-radius: 8px;
    }
    .inputBar input:focus {
        outline: none;
        border: 1px solid #b30000;
        box-shadow: 0 0 8px rgba(255,0,0,0.35);
    }

    .inputBar button {
        background: linear-gradient(45deg, #001e46, #b30000);
        border: none;
        color: white;
        padding: 12px 20px;
        font-size: 17px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 0 6px rgba(255,0,0,0.35);
        transition: 0.25s;
    }
    .inputBar button:hover {
        transform: scale(1.04);
        box-shadow: 0 0 10px rgba(255,0,0,0.55);
    }
</style>
</head>
<body>

<div class="header">
    Novacool AI – Fire Science Assistant
</div>

<div id="chatContainer"></div>

<div class="inputBar">
    <input id="userInput" type="text"
        placeholder="Ask anything about Novacool UEF, firefighting, ratios, training…" />
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    const chat = document.getElementById("chatContainer");
    const input = document.getElementById("userInput");

    // FULL URL so widget works outside Render as well
    const API_URL = "https://novacool-rag.onrender.com/chat";

    function appendMessage(role, text) {
        const div = document.createElement("div");
        div.className = "msg " + (role === "user" ? "user" : "ai");
        div.textContent = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }

    async function sendMessage() {
        const question = input.value.trim();
        if (!question) return;
        appendMessage("user", question);
        input.value = "";

        try {
            const res = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query: question })
            });
            const data = await res.json();
            appendMessage("ai", data.answer || "(No response)");
        } catch (err) {
            appendMessage("ai", "⚠ Backend unreachable — check deployment");
        }
        resizeFrame();
    }

    input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendMessage();
    });

    function resizeFrame() {
        if (window.parent) {
            window.parent.postMessage(
                { height: document.body.scrollHeight },
                "*"
            );
        }
    }

    const observer = new MutationObserver(resizeFrame);
    observer.observe(chat, { childList: true });
    resizeFrame();
</script>

</body>
</html>
