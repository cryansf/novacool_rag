<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Novacool Uploader</title>
  <style>
    body{background:#0b0b0d;color:#fff;font-family:Inter,system-ui,Segoe UI,Roboto,Ubuntu,Arial;margin:0;padding:0;text-align:center}
    h1{margin:30px 0}
    form{margin:20px auto;padding:20px;border:1px solid #333;border-radius:8px;max-width:400px;background:#131316}
    input,button{display:block;width:100%;margin:10px 0;padding:10px;border-radius:8px;border:none}
    button{background:#e11d2e;color:#fff;font-weight:bold;cursor:pointer;transition:opacity .3s}
    button:hover{background:#ff445a}
    button:disabled{background:#555;cursor:not-allowed;opacity:0.7}
    pre{background:#111;padding:10px;text-align:left;overflow:auto;max-height:300px}
  </style>
</head>
<body>
  <h1>Admin Uploader</h1>
  <form id="uploadForm" enctype="multipart/form-data">
    <input type="file" name="files" multiple/>
    <button type="submit">Upload</button>
  </form>
  <button id="reindex">Reindex All</button>
  <button id="crawl">Crawl novacool.com</button>
  <pre id="log"></pre>

  <script>
    const log = document.getElementById('log');
    const uploadForm = document.getElementById('uploadForm');
    const reindexBtn = document.getElementById('reindex');
    const crawlBtn = document.getElementById('crawl');

    function addLog(msg){ 
      const now = new Date().toLocaleTimeString();
      log.textContent += `[${now}] ${msg}\n`; 
      log.scrollTop = log.scrollHeight; 
    }

    // Upload handler
    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(uploadForm);
      addLog("Uploading files...");
      const r = await fetch('/upload', { method: 'POST', body: data });
      const j = await r.json();
      addLog("Uploaded: " + JSON.stringify(j.saved));
    });

    // Reindex handler
    reindexBtn.onclick = async () => {
      reindexBtn.disabled = true;
      reindexBtn.style.opacity = "0.6";
      reindexBtn.innerText = "Reindexing...";
      addLog("Reindexing started... please wait.");
      
      let dots = 0;
      const timer = setInterval(() => {
        if (reindexBtn.disabled) {
          reindexBtn.innerText = "Reindexing" + ".".repeat((dots++ % 3) + 1);
        } else {
          clearInterval(timer);
        }
      }, 600);

      try {
        const r = await fetch('/reindex', { method: 'POST' });
        const j = await r.json();

        if (j.error) {
          addLog("‚ùå Error: " + j.error);
          alert("Reindexing failed: " + j.error);
        } else {
          addLog(`‚úÖ Reindex complete: ${j.reindexed_chunks || 0} chunks indexed.`);
          alert("Reindexing complete!");
        }
      } catch (err) {
        addLog("‚ùå Error during reindex: " + err);
        alert("Error: " + err);
      }

      // Restore button after short delay
      setTimeout(() => {
        reindexBtn.disabled = false;
        reindexBtn.style.opacity = "1";
        reindexBtn.innerText = "Reindex All";
      }, 10000);
    };

    // Crawl handler
    crawlBtn.onclick = async () => {
      crawlBtn.disabled = true;
      addLog("Crawling site...");
      try {
        const r = await fetch('/crawl', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({url: 'https://novacool.com'}) });
        const j = await r.json();
        addLog("üåê Crawl result: " + JSON.stringify(j));
      } catch (err) {
        addLog("‚ùå Crawl error: " + err);
      }
      crawlBtn.disabled = false;
    };
  </script>
</body>
</html>
