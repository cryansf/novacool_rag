<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üì§ Document Uploader & Site Crawler</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background-color: #f7f9fb;
      color: #222;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    h1 { color: #0a66c2; }
    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }
    input[type="file"],
    input[type="text"] {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #0a66c2;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover { background-color: #004080; }
    #log {
      background: #fff;
      border-radius: 6px;
      padding: 12px;
      min-height: 140px;
      white-space: pre-wrap;
      border: 1px solid #ddd;
      overflow-y: auto;
    }
    .status-idle { color: gray; }
    .status-reindexing { color: #f39c12; }
    .status-crawling { color: #3498db; }
    .status-uploaded { color: #2ecc71; }
    .status-error { color: #e74c3c; }
  </style>
</head>
<body>
  <h1>Uploader Dashboard</h1>

  <form id="uploadForm">
    <label>üìÅ Upload a File:</label>
    <input type="file" id="fileInput" name="file" required>
    <button type="submit">Upload</button>
  </form>

  <form id="crawlForm">
    <label>üåê Crawl Website (enter base URL):</label>
    <input type="text" id="crawlUrl" placeholder="https://example.com" required>
    <button type="submit">Start Crawl</button>
  </form>

  <button id="reindexBtn">üîÑ Reindex All Files</button>

  <h3>Live Progress Log</h3>
  <div id="log">Waiting for updates...</div>

  <script>
    const logDiv = document.getElementById("log");

    async function updateStatus() {
      try {
        const res = await fetch("/status");
        const data = await res.json();
        const { stage, details } = data;
        const cls = "status-" + (stage || "idle");
        logDiv.innerHTML = `<b>Status:</b> <span class="${cls}">${stage}</span><br>${details || ''}`;
      } catch (e) {
        logDiv.textContent = "Error fetching status: " + e;
      }
    }

    // Upload handler
    document.getElementById("uploadForm").onsubmit = async e => {
      e.preventDefault();
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("Please select a file.");
      const formData = new FormData();
      formData.append("file", file);
      logDiv.textContent = "Uploading...";
      const res = await fetch("/upload", { method: "POST", body: formData });
      const result = await res.json();
      logDiv.textContent = result.message || JSON.stringify(result);
      updateStatus();
    };

    // Crawl handler
    document.getElementById("crawlForm").onsubmit = async e => {
      e.preventDefault();
      const url = document.getElementById("crawlUrl").value;
      logDiv.textContent = `Starting crawl for ${url}...`;
      const res = await fetch("/crawl", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
      });
      const result = await res.json();
      logDiv.textContent = result.message || JSON.stringify(result);
      updateStatus();
    };

    // Reindex handler
    document.getElementById("reindexBtn").onclick = async () => {
      logDiv.textContent = "Reindexing all uploaded files...";
      const res = await fetch("/reindex", { method: "POST" });
      const result = await res.json();
      logDiv.textContent = result.message || JSON.stringify(result);
      updateStatus();
    };

    // Poll status every 3s
    setInterval(updateStatus, 3000);
    updateStatus();
  </script>
</body>
</html>
