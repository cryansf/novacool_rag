<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Admin Uploader</title>
<style>
body {
  background-color: #0b0b0b;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 {
  margin-top: 40px;
}
button {
  background-color: #e53935;
  color: white;
  border: none;
  padding: 12px 24px;
  margin: 10px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.2s ease-in-out;
}
button:hover {
  background-color: #d32f2f;
}
button:disabled {
  background-color: #555;
  cursor: not-allowed;
}
#console {
  background-color: black;
  color: white;
  text-align: left;
  padding: 10px;
  margin-top: 20px;
  font-family: monospace;
  font-size: 14px;
  height: 150px;
  overflow-y: auto;
  border-top: 2px solid #333;
}
.error {
  color: #ff5252;
}
</style>
</head>
<body>
<h1>Admin Uploader</h1>
<div>
  <input type="file" id="fileInput" multiple />
  <button id="uploadBtn">Upload</button>
</div>
<div>
  <button id="reindexBtn">Reindex All</button>
  <button id="crawlBtn">Crawl novacool.com</button>
</div>
<div id="console"></div>
<script>
const log = (msg, cls='') => {
  const c = document.getElementById('console');
  const line = document.createElement('div');
  if (cls) line.classList.add(cls);
  const t = new Date().toLocaleTimeString();
  line.textContent = `[${t}] ${msg}`;
  c.appendChild(line);
  c.scrollTop = c.scrollHeight;
};

async function safeFetch(url, options) {
  try {
    const r = await fetch(url, options);
    const text = await r.text();
    try {
      return JSON.parse(text);
    } catch {
      log('‚ö†Ô∏è Server returned non‚ÄëJSON response:', 'error');
      log(text.slice(0, 200) + '...', 'error');
      return null;
    }
  } catch (e) {
    log('‚ùå Network error: ' + e, 'error');
    return null;
  }
}

document.getElementById('uploadBtn').onclick = async () => {
  const files = document.getElementById('fileInput').files;
  if (!files.length) {
    log('No files selected.', 'error');
    return;
  }
  log('üì§ Uploading files...');
  const fd = new FormData();
  for (const f of files) fd.append('files', f);
  document.getElementById('uploadBtn').disabled = true;
  const res = await safeFetch('/upload', { method: 'POST', body: fd });
  document.getElementById('uploadBtn').disabled = false;
  if (res && res.saved) log('‚úÖ Uploaded: ' + JSON.stringify(res.saved));
  else log('‚ö†Ô∏è Upload failed.', 'error');
};

document.getElementById('reindexBtn').onclick = async () => {
  log('üß© Reindexing started... please wait.');
  const btn = document.getElementById('reindexBtn');
  btn.disabled = true;
  const res = await safeFetch('/reindex', { method: 'POST' });
  btn.disabled = false;
  if (res && res.reindexed_chunks !== undefined)
    log(`‚úÖ Reindex complete: ${res.reindexed_chunks} chunks processed.`);
  else
    log('‚ö†Ô∏è Reindex failed or incomplete.', 'error');
};

document.getElementById('crawlBtn').onclick = async () => {
  log('üåê Crawling site...');
  const btn = document.getElementById('crawlBtn');
  btn.disabled = true;
  const res = await safeFetch('/crawl', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({url: 'https://novacool.com'})
  });
  btn.disabled = false;
  if (res && res.message)
    log(`‚úÖ ${res.message} (${res.chunks} chunks)`);
  else
    log('‚ö†Ô∏è Crawl failed.', 'error');
};
</script>
</body>
</html>
