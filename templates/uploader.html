<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Uploader | Novacool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      padding: 30px;
    }
    h1 {
      color: #fff;
      font-size: 2rem;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #1b1b1b;
      border-radius: 12px;
      padding: 20px 30px;
      box-shadow: 0 0 10px #000;
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      margin-right: 10px;
      transition: 0.2s ease;
    }
    button:hover {
      opacity: 0.9;
    }
    .upload { background: #e53e3e; color: white; }
    .reindex { background: #38b2ac; color: white; }
    .crawl { background: #3182ce; color: white; }

    .progress-container {
      width: 100%;
      background: #333;
      border-radius: 8px;
      margin-top: 20px;
      height: 14px;
      overflow: hidden;
    }
    .progress-bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #00b4d8, #0077b6);
      transition: width 0.3s ease;
    }

    #log {
      background: #0d0d0d;
      border: 1px solid #333;
      padding: 12px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 280px;
      overflow-y: auto;
      margin-top: 15px;
      white-space: pre-wrap;
    }

    .footer {
      text-align: center;
      margin-top: 20px;
      color: #888;
      font-size: 0.9rem;
    }

    .drag-area {
      border: 2px dashed #444;
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      color: #aaa;
      margin-top: 20px;
    }
    .drag-area.dragover {
      border-color: #00b4d8;
      background: rgba(0, 180, 216, 0.05);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Admin Uploader</h1>
    <p>Drop PDFs, DOCX, TXT, or MD files ‚Üí <b>Upload</b>, <b>Reindex</b>, or <b>Crawl Site</b>.</p>

    <div class="drag-area" id="drop-zone">Drag & Drop files here</div>

    <div style="margin-top: 20px;">
      <input type="file" id="file-input" multiple style="display:none" />
      <button class="upload" id="upload-btn">Upload</button>
      <button class="reindex" id="reindex-btn">Reindex</button>
      <button class="crawl" id="crawl-btn">üåê Crawl novacool.com</button>
    </div>

    <div class="progress-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div id="log">Idle.</div>

    <div class="footer">
      Chat UI: <a href="/widget" style="color:#00b4d8;">/widget</a>
    </div>
  </div>

  <script>
    const uploadBtn = document.getElementById('upload-btn');
    const reindexBtn = document.getElementById('reindex-btn');
    const crawlBtn = document.getElementById('crawl-btn');
    const progressBar = document.getElementById('progress-bar');
    const logDiv = document.getElementById('log');
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');

    function log(msg, reset=false) {
      if (reset) logDiv.textContent = '';
      logDiv.textContent += msg + "\\n";
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // Upload files
    uploadBtn.onclick = async () => {
      fileInput.click();
      fileInput.onchange = async () => {
        const files = fileInput.files;
        if (!files.length) return;
        const fd = new FormData();
        for (let f of files) fd.append('files', f);
        log("Uploading files...", true);
        progressBar.style.width = "25%";
        const r = await fetch("/upload", { method: "POST", body: fd });
        const j = await r.json();
        progressBar.style.width = "100%";
        log("‚úÖ Uploaded: " + JSON.stringify(j));
        setTimeout(() => progressBar.style.width = "0%", 500);
      };
    };

    // Reindex
    reindexBtn.onclick = async () => {
      log("Reindexing...", true);
      progressBar.style.width = "30%";
      const r = await fetch("/reindex", { method: "POST" });
      const j = await r.json();
      progressBar.style.width = "100%";
      log("‚úÖ Reindexed: " + JSON.stringify(j));
      setTimeout(() => progressBar.style.width = "0%", 700);
    };

    // Crawl novacool.com
    crawlBtn.onclick = async () => {
      log("Starting crawl of novacool.com...", true);
      progressBar.style.width = "10%";
      const r = await fetch("/crawl", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url: "https://novacool.com" })
      });
      const j = await r.json();
      if (j.error) {
        log("‚ùå " + j.error);
      } else {
        log("‚úÖ " + j.message);
      }
      if (j.log) {
        log("\\nCrawl Log:\\n" + j.log.join("\\n"));
      }
      progressBar.style.width = "100%";
      setTimeout(() => progressBar.style.width = "0%", 800);
    };

    // Drag-and-drop upload
    dropZone.addEventListener("dragover", e => {
      e.preventDefault(); dropZone.classList.add("dragover");
    });
    dropZone.addEventListener("dragleave", e => {
      e.preventDefault(); dropZone.classList.remove("dragover");
    });
    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
      const files = e.dataTransfer.files;
      if (!files.length) return;
      const fd = new FormData();
      for (let f of files) fd.append("files", f);
      log("Uploading dropped files...", true);
      fetch("/upload", { method: "POST", body: fd })
        .then(r => r.json())
        .then(j => log("‚úÖ Uploaded: " + JSON.stringify(j)))
        .catch(err => log("‚ùå " + err));
    });
  </script>
</body>
</html>
