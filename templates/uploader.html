<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ title }}</title>
  <style>
    :root {
      --bg:#0b0b0d;
      --panel:#131316;
      --accent:#e11d2e;
      --accent-2:#ff445a;
      --text:#f2f2f2;
      --muted:#a7a7ab;
      --border:#242429;
    }
    *{box-sizing:border-box}
    body {
      margin:0;
      background:linear-gradient(180deg,#0b0b0d,#101014);
      color:var(--text);
      font-family:Inter,system-ui,Segoe UI,Roboto,Ubuntu,Arial;
    }
    .wrap {max-width:900px;margin:0 auto;padding:24px;}
    h1 {margin:0 0 6px;}
    .muted {color:var(--muted);}
    .panel {
      padding:18px;border:1px solid var(--border);
      border-radius:14px;background:var(--panel);
    }
    .drop {
      margin-top:14px;border:2px dashed #3a3a41;border-radius:12px;
      height:180px;display:flex;gap:10px;align-items:center;justify-content:center;
      color:var(--muted);transition:all .2s ease;
    }
    .drop.drag {border-color:var(--accent);color:#fff;}
    .row {display:flex;gap:10px;margin-top:14px;}
    input[type=file]{display:none}
    .btn {
      padding:10px 14px;border-radius:12px;border:1px solid #8b0d18;
      background:var(--accent);color:#fff;font-weight:600;cursor:pointer;
      transition:background .2s ease;
    }
    .btn:hover {background:var(--accent-2);}
    .ghost {background:#222228;border:1px solid var(--border);color:#fff;}
    .crawl {background:#1f1f23;border:1px solid #303036;color:#fff;}
    .crawl:hover {background:#33333a;}
    .list {margin-top:10px;font-size:14px;max-height:200px;overflow:auto;}
    .ok {color:#72e49b;}
    .err {color:#ff8896;}
    .progress {
      width:100%;height:10px;background:#222;margin-top:14px;border-radius:6px;
      overflow:hidden;display:none;
    }
    .bar {
      height:100%;width:0%;background:var(--accent);transition:width .3s ease;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Admin Uploader</h1>
    <div class="muted">
      Drop PDFs, DOCX, TXT, or MD files ‚Üí <strong>Upload</strong>, <strong>Reindex</strong>, or <strong>Crawl Site</strong>.
    </div>

    <div class="panel">
      <div id="drop" class="drop">Drag & drop files here</div>
      <div class="row">
        <label class="btn">
          Choose Files
          <input id="file" type="file" multiple>
        </label>
        <button id="upload" class="btn">Upload</button>
        <button id="reindex" class="btn ghost">Reindex</button>
        <button id="crawl" class="btn crawl">üåê Crawl novacool.com</button>
      </div>

      <div class="progress" id="progress"><div class="bar" id="bar"></div></div>
      <div id="list" class="list"></div>
    </div>

    <p class="muted" style="margin-top:16px">Chat UI: <a href="/widget">/widget</a></p>
  </div>

  <script>
    const drop = document.getElementById('drop');
    const file = document.getElementById('file');
    const list = document.getElementById('list');
    const bar = document.getElementById('bar');
    const progress = document.getElementById('progress');
    let files = [];

    function show(msg, cls) {
      const p = document.createElement('div');
      p.className = cls || '';
      p.textContent = msg;
      list.appendChild(p);
      list.scrollTop = list.scrollHeight;
    }

    function setProgress(val) {
      progress.style.display = 'block';
      bar.style.width = val + '%';
      if (val >= 100) setTimeout(() => progress.style.display = 'none', 1000);
    }

    drop.addEventListener('dragover', (e)=>{e.preventDefault();drop.classList.add('drag');});
    drop.addEventListener('dragleave', ()=>drop.classList.remove('drag'));
    drop.addEventListener('drop',(e)=>{
      e.preventDefault();drop.classList.remove('drag');
      files = [...files, ...e.dataTransfer.files];
      show(`${e.dataTransfer.files.length} file(s) added`);
    });

    file.addEventListener('change', ()=>{
      files = [...files, ...file.files];
      show(`${file.files.length} file(s) added`);
      file.value = '';
    });

    document.getElementById('upload').onclick = async ()=>{
      if(!files.length){show('No files selected','err');return;}
      const fd = new FormData();
      for(const f of files) fd.append('files', f);
      show('Uploading‚Ä¶');
      const r = await fetch('/upload',{method:'POST',body:fd});
      const data = await r.json();
      if(data.saved && data.saved.length){
        show(`Uploaded: ${data.saved.join(', ')}`,'ok');
        files = [];
      }else{
        show('Upload failed','err');
      }
    };

    document.getElementById('reindex').onclick = async ()=>{
      show('Reindexing‚Ä¶');
      setProgress(0);
      const r = await fetch('/reindex',{method:'POST'});
      const data = await r.json();
      setProgress(100);
      show(`Reindexed chunks: ${data.reindexed_chunks ?? 0}`,'ok');
    };

    document.getElementById('crawl').onclick = async ()=>{
      show('Starting crawl of novacool.com‚Ä¶');
      setProgress(5);
      try {
        const r = await fetch('/crawl',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({url:'https://novacool.com'})
        });
        let pct = 10;
        const interval = setInterval(()=>{
          pct = Math.min(pct + 10, 90);
          setProgress(pct);
        },1000);

        const data = await r.json();
        clearInterval(interval);
        setProgress(100);

        if(data.error){
          show('Crawl failed: ' + data.error,'err');
        }else{
          show(data.message,'ok');
        }
      }catch(err){
        show('Crawl failed: ' + err,'err');
        setProgress(0);
      }
    };
  </script>
</body>
</html>
